{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ClassSerializerInterceptor = void 0;\nconst tslib_1 = require(\"tslib\");\nconst operators_1 = require(\"rxjs/operators\");\nconst core_1 = require(\"../decorators/core\");\nconst file_stream_1 = require(\"../file-stream\");\nconst load_package_util_1 = require(\"../utils/load-package.util\");\nconst shared_utils_1 = require(\"../utils/shared.utils\");\nconst class_serializer_constants_1 = require(\"./class-serializer.constants\");\nlet classTransformer = {};\n// NOTE (external)\n// We need to deduplicate them here due to the circular dependency\n// between core and common packages\nconst REFLECTOR = 'Reflector';\n/**\n * @publicApi\n */\nlet ClassSerializerInterceptor = class ClassSerializerInterceptor {\n  constructor(reflector) {\n    let defaultOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var _a;\n    this.reflector = reflector;\n    this.defaultOptions = defaultOptions;\n    classTransformer = (_a = defaultOptions === null || defaultOptions === void 0 ? void 0 : defaultOptions.transformerPackage) !== null && _a !== void 0 ? _a : (0, load_package_util_1.loadPackage)('class-transformer', 'ClassSerializerInterceptor', () => require('class-transformer'));\n    if (!(defaultOptions === null || defaultOptions === void 0 ? void 0 : defaultOptions.transformerPackage)) {\n      require('class-transformer');\n    }\n  }\n  intercept(context, next) {\n    const contextOptions = this.getContextOptions(context);\n    const options = Object.assign(Object.assign({}, this.defaultOptions), contextOptions);\n    return next.handle().pipe((0, operators_1.map)(res => this.serialize(res, options)));\n  }\n  /**\n   * Serializes responses that are non-null objects nor streamable files.\n   */\n  serialize(response, options) {\n    if (!(0, shared_utils_1.isObject)(response) || response instanceof file_stream_1.StreamableFile) {\n      return response;\n    }\n    return Array.isArray(response) ? response.map(item => this.transformToPlain(item, options)) : this.transformToPlain(response, options);\n  }\n  transformToPlain(plainOrClass, options) {\n    if (!plainOrClass) {\n      return plainOrClass;\n    }\n    if (!options.type) {\n      return classTransformer.classToPlain(plainOrClass, options);\n    }\n    if (plainOrClass instanceof options.type) {\n      return classTransformer.classToPlain(plainOrClass, options);\n    }\n    const instance = classTransformer.plainToClass(options.type, plainOrClass);\n    return classTransformer.classToPlain(instance, options);\n  }\n  getContextOptions(context) {\n    return this.reflector.getAllAndOverride(class_serializer_constants_1.CLASS_SERIALIZER_OPTIONS, [context.getHandler(), context.getClass()]);\n  }\n};\nClassSerializerInterceptor = tslib_1.__decorate([(0, core_1.Injectable)(), tslib_1.__param(0, (0, core_1.Inject)(REFLECTOR)), tslib_1.__param(1, (0, core_1.Optional)()), tslib_1.__metadata(\"design:paramtypes\", [Object, Object])], ClassSerializerInterceptor);\nexports.ClassSerializerInterceptor = ClassSerializerInterceptor;","map":{"version":3,"names":["Object","defineProperty","exports","value","ClassSerializerInterceptor","tslib_1","require","operators_1","core_1","file_stream_1","load_package_util_1","shared_utils_1","class_serializer_constants_1","classTransformer","REFLECTOR","constructor","reflector","defaultOptions","arguments","length","undefined","_a","transformerPackage","loadPackage","intercept","context","next","contextOptions","getContextOptions","options","assign","handle","pipe","map","res","serialize","response","isObject","StreamableFile","Array","isArray","item","transformToPlain","plainOrClass","type","classToPlain","instance","plainToClass","getAllAndOverride","CLASS_SERIALIZER_OPTIONS","getHandler","getClass","__decorate","Injectable","__param","Inject","Optional","__metadata"],"sources":["/home/benjamin/Documents/42/42_ft_transcendence/front/node_modules/@nestjs/common/serializer/class-serializer.interceptor.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ClassSerializerInterceptor = void 0;\nconst tslib_1 = require(\"tslib\");\nconst operators_1 = require(\"rxjs/operators\");\nconst core_1 = require(\"../decorators/core\");\nconst file_stream_1 = require(\"../file-stream\");\nconst load_package_util_1 = require(\"../utils/load-package.util\");\nconst shared_utils_1 = require(\"../utils/shared.utils\");\nconst class_serializer_constants_1 = require(\"./class-serializer.constants\");\nlet classTransformer = {};\n// NOTE (external)\n// We need to deduplicate them here due to the circular dependency\n// between core and common packages\nconst REFLECTOR = 'Reflector';\n/**\n * @publicApi\n */\nlet ClassSerializerInterceptor = class ClassSerializerInterceptor {\n    constructor(reflector, defaultOptions = {}) {\n        var _a;\n        this.reflector = reflector;\n        this.defaultOptions = defaultOptions;\n        classTransformer =\n            (_a = defaultOptions === null || defaultOptions === void 0 ? void 0 : defaultOptions.transformerPackage) !== null && _a !== void 0 ? _a : (0, load_package_util_1.loadPackage)('class-transformer', 'ClassSerializerInterceptor', () => require('class-transformer'));\n        if (!(defaultOptions === null || defaultOptions === void 0 ? void 0 : defaultOptions.transformerPackage)) {\n            require('class-transformer');\n        }\n    }\n    intercept(context, next) {\n        const contextOptions = this.getContextOptions(context);\n        const options = Object.assign(Object.assign({}, this.defaultOptions), contextOptions);\n        return next\n            .handle()\n            .pipe((0, operators_1.map)((res) => this.serialize(res, options)));\n    }\n    /**\n     * Serializes responses that are non-null objects nor streamable files.\n     */\n    serialize(response, options) {\n        if (!(0, shared_utils_1.isObject)(response) || response instanceof file_stream_1.StreamableFile) {\n            return response;\n        }\n        return Array.isArray(response)\n            ? response.map(item => this.transformToPlain(item, options))\n            : this.transformToPlain(response, options);\n    }\n    transformToPlain(plainOrClass, options) {\n        if (!plainOrClass) {\n            return plainOrClass;\n        }\n        if (!options.type) {\n            return classTransformer.classToPlain(plainOrClass, options);\n        }\n        if (plainOrClass instanceof options.type) {\n            return classTransformer.classToPlain(plainOrClass, options);\n        }\n        const instance = classTransformer.plainToClass(options.type, plainOrClass);\n        return classTransformer.classToPlain(instance, options);\n    }\n    getContextOptions(context) {\n        return this.reflector.getAllAndOverride(class_serializer_constants_1.CLASS_SERIALIZER_OPTIONS, [\n            context.getHandler(),\n            context.getClass(),\n        ]);\n    }\n};\nClassSerializerInterceptor = tslib_1.__decorate([\n    (0, core_1.Injectable)(),\n    tslib_1.__param(0, (0, core_1.Inject)(REFLECTOR)),\n    tslib_1.__param(1, (0, core_1.Optional)()),\n    tslib_1.__metadata(\"design:paramtypes\", [Object, Object])\n], ClassSerializerInterceptor);\nexports.ClassSerializerInterceptor = ClassSerializerInterceptor;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}