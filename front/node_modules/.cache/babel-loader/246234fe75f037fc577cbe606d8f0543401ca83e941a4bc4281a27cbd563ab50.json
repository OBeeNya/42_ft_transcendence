{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createCacheManager = void 0;\nconst load_package_util_1 = require(\"../utils/load-package.util\");\nconst cache_constants_1 = require(\"./cache.constants\");\nconst cache_module_definition_1 = require(\"./cache.module-definition\");\nconst default_options_1 = require(\"./default-options\");\n/**\n * Creates a CacheManager Provider.\n *\n * @publicApi\n */\nfunction createCacheManager() {\n  return {\n    provide: cache_constants_1.CACHE_MANAGER,\n    useFactory: async options => {\n      const cacheManager = (0, load_package_util_1.loadPackage)('cache-manager', 'CacheModule', () => require('cache-manager'));\n      const cacheManagerIsv5OrGreater = ('memoryStore' in cacheManager);\n      const cachingFactory = async (store, options) => {\n        if (!cacheManagerIsv5OrGreater) {\n          return cacheManager.caching(Object.assign(Object.assign({}, default_options_1.defaultCacheOptions), Object.assign(Object.assign({}, options), {\n            store\n          })));\n        }\n        let cache = 'memory';\n        default_options_1.defaultCacheOptions.ttl *= 1000;\n        if (typeof store === 'object') {\n          if ('create' in store) {\n            cache = store.create;\n          } else {\n            cache = store;\n          }\n        } else if (typeof store === 'function') {\n          cache = store;\n        }\n        return cacheManager.caching(cache, Object.assign(Object.assign({}, default_options_1.defaultCacheOptions), options));\n      };\n      return Array.isArray(options) ? cacheManager.multiCaching(await Promise.all(options.map(option => cachingFactory(option.store, option)))) : cachingFactory(options.store, options);\n    },\n    inject: [cache_module_definition_1.MODULE_OPTIONS_TOKEN]\n  };\n}\nexports.createCacheManager = createCacheManager;","map":{"version":3,"names":["Object","defineProperty","exports","value","createCacheManager","load_package_util_1","require","cache_constants_1","cache_module_definition_1","default_options_1","provide","CACHE_MANAGER","useFactory","options","cacheManager","loadPackage","cacheManagerIsv5OrGreater","cachingFactory","store","caching","assign","defaultCacheOptions","cache","ttl","create","Array","isArray","multiCaching","Promise","all","map","option","inject","MODULE_OPTIONS_TOKEN"],"sources":["/home/benjamin/Documents/42/42_ft_transcendence/front/node_modules/@nestjs/common/cache/cache.providers.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createCacheManager = void 0;\nconst load_package_util_1 = require(\"../utils/load-package.util\");\nconst cache_constants_1 = require(\"./cache.constants\");\nconst cache_module_definition_1 = require(\"./cache.module-definition\");\nconst default_options_1 = require(\"./default-options\");\n/**\n * Creates a CacheManager Provider.\n *\n * @publicApi\n */\nfunction createCacheManager() {\n    return {\n        provide: cache_constants_1.CACHE_MANAGER,\n        useFactory: async (options) => {\n            const cacheManager = (0, load_package_util_1.loadPackage)('cache-manager', 'CacheModule', () => require('cache-manager'));\n            const cacheManagerIsv5OrGreater = 'memoryStore' in cacheManager;\n            const cachingFactory = async (store, options) => {\n                if (!cacheManagerIsv5OrGreater) {\n                    return cacheManager.caching(Object.assign(Object.assign({}, default_options_1.defaultCacheOptions), Object.assign(Object.assign({}, options), { store })));\n                }\n                let cache = 'memory';\n                default_options_1.defaultCacheOptions.ttl *= 1000;\n                if (typeof store === 'object') {\n                    if ('create' in store) {\n                        cache = store.create;\n                    }\n                    else {\n                        cache = store;\n                    }\n                }\n                else if (typeof store === 'function') {\n                    cache = store;\n                }\n                return cacheManager.caching(cache, Object.assign(Object.assign({}, default_options_1.defaultCacheOptions), options));\n            };\n            return Array.isArray(options)\n                ? cacheManager.multiCaching(await Promise.all(options.map(option => cachingFactory(option.store, option))))\n                : cachingFactory(options.store, options);\n        },\n        inject: [cache_module_definition_1.MODULE_OPTIONS_TOKEN],\n    };\n}\nexports.createCacheManager = createCacheManager;\n"],"mappings":"AAAA,YAAY;;AACZA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,kBAAkB,GAAG,KAAK,CAAC;AACnC,MAAMC,mBAAmB,GAAGC,OAAO,CAAC,4BAA4B,CAAC;AACjE,MAAMC,iBAAiB,GAAGD,OAAO,CAAC,mBAAmB,CAAC;AACtD,MAAME,yBAAyB,GAAGF,OAAO,CAAC,2BAA2B,CAAC;AACtE,MAAMG,iBAAiB,GAAGH,OAAO,CAAC,mBAAmB,CAAC;AACtD;AACA;AACA;AACA;AACA;AACA,SAASF,kBAAkBA,CAAA,EAAG;EAC1B,OAAO;IACHM,OAAO,EAAEH,iBAAiB,CAACI,aAAa;IACxCC,UAAU,EAAE,MAAOC,OAAO,IAAK;MAC3B,MAAMC,YAAY,GAAG,CAAC,CAAC,EAAET,mBAAmB,CAACU,WAAW,EAAE,eAAe,EAAE,aAAa,EAAE,MAAMT,OAAO,CAAC,eAAe,CAAC,CAAC;MACzH,MAAMU,yBAAyB,IAAG,aAAa,IAAIF,YAAY;MAC/D,MAAMG,cAAc,GAAG,MAAAA,CAAOC,KAAK,EAAEL,OAAO,KAAK;QAC7C,IAAI,CAACG,yBAAyB,EAAE;UAC5B,OAAOF,YAAY,CAACK,OAAO,CAACnB,MAAM,CAACoB,MAAM,CAACpB,MAAM,CAACoB,MAAM,CAAC,CAAC,CAAC,EAAEX,iBAAiB,CAACY,mBAAmB,CAAC,EAAErB,MAAM,CAACoB,MAAM,CAACpB,MAAM,CAACoB,MAAM,CAAC,CAAC,CAAC,EAAEP,OAAO,CAAC,EAAE;YAAEK;UAAM,CAAC,CAAC,CAAC,CAAC;QAC9J;QACA,IAAII,KAAK,GAAG,QAAQ;QACpBb,iBAAiB,CAACY,mBAAmB,CAACE,GAAG,IAAI,IAAI;QACjD,IAAI,OAAOL,KAAK,KAAK,QAAQ,EAAE;UAC3B,IAAI,QAAQ,IAAIA,KAAK,EAAE;YACnBI,KAAK,GAAGJ,KAAK,CAACM,MAAM;UACxB,CAAC,MACI;YACDF,KAAK,GAAGJ,KAAK;UACjB;QACJ,CAAC,MACI,IAAI,OAAOA,KAAK,KAAK,UAAU,EAAE;UAClCI,KAAK,GAAGJ,KAAK;QACjB;QACA,OAAOJ,YAAY,CAACK,OAAO,CAACG,KAAK,EAAEtB,MAAM,CAACoB,MAAM,CAACpB,MAAM,CAACoB,MAAM,CAAC,CAAC,CAAC,EAAEX,iBAAiB,CAACY,mBAAmB,CAAC,EAAER,OAAO,CAAC,CAAC;MACxH,CAAC;MACD,OAAOY,KAAK,CAACC,OAAO,CAACb,OAAO,CAAC,GACvBC,YAAY,CAACa,YAAY,CAAC,MAAMC,OAAO,CAACC,GAAG,CAAChB,OAAO,CAACiB,GAAG,CAACC,MAAM,IAAId,cAAc,CAACc,MAAM,CAACb,KAAK,EAAEa,MAAM,CAAC,CAAC,CAAC,CAAC,GACzGd,cAAc,CAACJ,OAAO,CAACK,KAAK,EAAEL,OAAO,CAAC;IAChD,CAAC;IACDmB,MAAM,EAAE,CAACxB,yBAAyB,CAACyB,oBAAoB;EAC3D,CAAC;AACL;AACA/B,OAAO,CAACE,kBAAkB,GAAGA,kBAAkB"},"metadata":{},"sourceType":"script","externalDependencies":[]}